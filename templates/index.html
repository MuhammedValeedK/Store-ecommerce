{% extends "base.html" %}

{% block title %}
Home
{% endblock title %}


{% if request.user.is_authenticated %}
{% block navbar %}
	<!-- Icon header -->
	<div class="wrap-icon-header flex-w flex-r-m">
		{% comment %} <div class="icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 js-show-modal-search">
			<i class="zmdi zmdi-search"></i>
		</div> {% endcomment %}

		<button type="button" class="nav-link scrollto  p-3 m-2 text-black" id="popcart" data-container="body" data-toggle="popover" data-placement="bottom" data-html="true" ><i class="fa-solid fa-cart-shopping"></i>  Cart (<span id="cart">0</span>)
		</button>

		{% comment %} <a href="#" class="dis-block icon-header-item cl2 hov-cl1 trans-04 p-l-22 p-r-11 icon-header-noti" data-notify="0">
			<i class="zmdi zmdi-favorite-outline"></i>
		</a> {% endcomment %}
	</div>
{% endblock navbar %}
{% endif %}

{% block body %}
	


	<!-- Slider -->
	<section class="section-slide">
		<div class="wrap-slick1">
			<div class="slick1">
				{% for slider in sliders %}
				<div class="item-slick1" style="background-image: url('{{ slider.image.url }}');">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="rollIn" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									{{ slider.title }}
								</span>
							</div>
	
							{% if slider.subtitle %}
							<div class="layer-slick1 animated visible-false" data-appear="lightSpeedIn" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									{{ slider.subtitle }}
								</h2>
							</div>
							{% endif %}
	
							{% if slider.button_text and slider.button_link %}
							<div class="layer-slick1 animated visible-false" data-appear="slideInUp" data-delay="1600">
								<a href="{{ slider.button_link }}" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									{{ slider.button_text }}
								</a>
							</div>
							{% endif %}
						</div>

					</div>
				</div>
				{% endfor %}
			</div>
		</div>
	</section>
	


	{% comment %} <!-- Banner -->
	<div class="sec-banner bg0 p-t-80 p-b-50">
		<div class="container">
			<div class="row">
				<div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
					<!-- Block1 -->
					<div class="block1 wrap-pic-w">
						<img src="static/images/banner-01.jpg" alt="IMG-BANNER">

						<a href="product.html" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
							<div class="block1-txt-child1 flex-col-l">
								<span class="block1-name ltext-102 trans-04 p-b-8">
									Women
								</span>

								<span class="block1-info stext-102 trans-04">
									Spring 2018
								</span>
							</div>

							<div class="block1-txt-child2 p-b-4 trans-05">
								<div class="block1-link stext-101 cl0 trans-09">
									Shop Now
								</div>
							</div>
						</a>
					</div>
				</div>

				<div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
					<!-- Block1 -->
					<div class="block1 wrap-pic-w">
						<img src="static/images/banner-02.jpg" alt="IMG-BANNER">

						<a href="product.html" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
							<div class="block1-txt-child1 flex-col-l">
								<span class="block1-name ltext-102 trans-04 p-b-8">
									Men
								</span>

								<span class="block1-info stext-102 trans-04">
									Spring 2018
								</span>
							</div>

							<div class="block1-txt-child2 p-b-4 trans-05">
								<div class="block1-link stext-101 cl0 trans-09">
									Shop Now
								</div>
							</div>
						</a>
					</div>
				</div>

				<div class="col-md-6 col-xl-4 p-b-30 m-lr-auto">
					<!-- Block1 -->
					<div class="block1 wrap-pic-w">
						<img src="static/images/banner-03.jpg" alt="IMG-BANNER">

						<a href="product.html" class="block1-txt ab-t-l s-full flex-col-l-sb p-lr-38 p-tb-34 trans-03 respon3">
							<div class="block1-txt-child1 flex-col-l">
								<span class="block1-name ltext-102 trans-04 p-b-8">
									Accessories
								</span>

								<span class="block1-info stext-102 trans-04">
									New Trend
								</span>
							</div>

							<div class="block1-txt-child2 p-b-4 trans-05">
								<div class="block1-link stext-101 cl0 trans-09">
									Shop Now
								</div>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div> {% endcomment %}
	
		

 <section class="bg0 p-t-23 p-b-140">
			 {% comment %} <div class="container">
				<!-- Messages -->
				{% for message in messages %}
					<div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
						<strong>{{ message }}</strong>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>
				{% endfor %}
		
				<!-- Main Title -->
				<div class="text-center mb-5">
					<h2 class="display-4 mb-4">Our Products</h2>
					<div class="border-bottom border-3 border-dark w-25 mx-auto"></div>
				</div>
		
				<!-- Products Section -->
				{% for product, range, nSlides in allProds %}
					<!-- Category Title -->
					<div class="category-header mb-4">
						<h3 class="text-center position-relative py-3">
							<span class="bg-dark text-white px-4 py-2 rounded">
								{{ product.0.category }} Flash Sale
							</span>
						</h3>
					</div>
		
					<div class="container mb-5">
						<div class="row g-4">
							{% for i in product %}
								<div class="col-md-3">
									<div class="card h-100 shadow-sm border-0 rounded-3 overflow-hidden">
										<div class="position-relative">
											<img src="/media/{{ i.image }}" class="card-img-top" alt="{{ i.product_name }}" 
												 style="height: 200px; object-fit: cover;">
											<!-- Quick view button overlay -->
											<div class="position-absolute top-0 end-0 m-2">
												<button type="button" class="btn btn-light btn-sm" 
														data-bs-toggle="modal" 
														data-bs-target="#productModal{{ i.id }}">
													<i class="fa-solid fa-eye"></i>
												</button>
											</div>
										</div>
		
										<div class="card-body d-flex flex-column">
											<h5 class="card-title mb-2" id="namepr{{ i.id }}">{{ i.product_name }}</h5>
											<p class="card-text text-muted mb-3">{{ i.desc|slice:"0:53" }}...</p>
											<div class="mt-auto">
												<h6 class="fw-bold mb-3">₹{{ i.price }}</h6>
												<span id="divpr{{i.id}}" class="divpr">
													<button id="pr{{i.id}}" class="btn btn-danger cart btn-sm mt-0">
													  AddToCart <i class="fa-solid fa-cart-shopping"></i>
													</button>
												  </span>
											</div>
										</div>
									</div>
								</div>
		
								<!-- Modal for Quick View -->
								<div class="modal fade" id="productModal{{ i.id }}" tabindex="-1">
									<div class="modal-dialog modal-lg">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">{{ i.product_name }}</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
											</div>
											<div class="modal-body">
												<div class="row">
													<div class="col-md-6">
														<img src="/media/{{ i.image }}" class="img-fluid rounded" alt="{{ i.product_name }}">
													</div>
													<div class="col-md-6">
														<h5 class="mb-3">Description</h5>
														<p>{{ i.desc }}</p>
														<h6 class="fw-bold mb-3">Price: ₹{{ i.price }}</h6>
														<button id="pr{{ i.id }}" class="btn btn-dark cart">
															Add To Cart <i class="fa-solid fa-cart-shopping ms-1"></i>
														</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>
					</div>
				{% endfor %}
		
				<!-- Load More Button -->
				<div class="text-center mt-5">
					<button class="btn btn-outline-dark btn-lg px-5">
						Load More
					</button>
				</div>
			</div>  {% endcomment %}
		  <div class="container"> 
				{% comment %} {% for message in messages %}
			
				<div
				  class="alert alert-{{message.tags}} alert-dismissible fade show"
				  role="alert"
				>
				  <strong>{{message}}</strong>
				  <button
					type="button"
					class="btn-close"
					data-bs-dismiss="alert"
					aria-label="Close"
				  ></button>
				</div>
				{% endfor %} {% endcomment %}
			
				<div class="section-title">
				   <h3>Check exciting <span>Products</span></h3>
				</div>
			
				{% for product, range, nSlides in allProds %}
			
				<h3 class="my-3 text-center text-success bg-light">
				  {{product.0.category}} Flash Sale
				</h3>
			
				<div class="container">
				  <div class="row">
			
						{% for i in product %}
							<div class="col-md-3 mt-3">
								<div class="card h-100 shadow-sm border-0 rounded-3 overflow-hidden">
									<div class="position-relative">
										<a href="{% url 'product_detail' i.id %}">
											<button class="btn btn-dark btn-sm cart"><i class="fa-solid fa-eye"></i></button>
										</a>
										
										<img src="/media/{{i.image}}" class="img-fluid rounded" alt="not found" style="height: 200px; ">
										<div class="card-body d-flex flex-column">
											<h5 class="card-title mt-2" id="namepr{{i.id}}">{{i.product_name}}</h5>
											<p class="card-text">{{i.desc|slice:"0:53"}}...</p>
											<h6 class="card-title mb-3">
											Price:₹<span id="pricepr{{i.id}}">{{i.price}}</span>
											</h6>
											<span id="divpr{{i.id}}" class="divpr">
											<button id="pr{{i.id}}" class="btn btn-danger cart btn-sm mt-0">
												AddToCart <i class="fa-solid fa-cart-shopping"></i>
											</button>
											</span>
					
										</div>
									</div>
								</div>
							</div>
				
						{% endfor %}
				  </div>
				</div>
				{% endfor %}
			  </div> 
			  <!-- Load More Button -->
				<div class="text-center mt-5">
					<button class="btn btn-outline-dark btn-lg px-5">
						Load More
					</button>
				</div>
			</div> 
		
		
		</section>

		<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
		  
		<script>
  
			//find pout the card from local storage
		  
			if (localStorage.getItem('cart') == null) {
				var cart = {};
			} else {
				cart = JSON.parse(localStorage.getItem('cart'));
				updateCart(cart);
		  
			}
			// add or increment code
		  
			// $('.cart').click(function() {
			$('.divpr').on('click', 'button.cart', function() {
				var idstr = this.id.toString();
				console.log(idstr)
		  
				if (cart[idstr] != undefined) {
					qty = cart[idstr][0] + 1;
		  
				} else {
					qty = 1;
					name = document.getElementById('name' + idstr).innerHTML;
					price = document.getElementById('price' + idstr).innerHTML;
					cart[idstr] = [qty, name, price];
					
				}
				updateCart(cart);
		  
				localStorage.setItem('cart', JSON.stringify(cart));
				document.getElementById('cart').innerHTML = Object.keys(cart).length;
				console.log( Object.keys(cart).length)
				document.getElementById("popcart").click();
			});
			// add pop over to cart
		  
			$('#popcart').popover();
		  
			updatePopover(cart);
			function updatePopover(cart) {
		  
				
				console.log('we are  inside update popover');
				
				var popStr = "";
				var popStr = popStr + "<h5> cart for your items in my shopping cart </h5> <div class='mx-2 my-2'>";
				var i = 1;
				for (var item in cart) {
					popStr = popStr + "<b>" + i + "</b>. ";
					popStr = popStr + document.getElementById('name' + item).innerHTML.slice(0, 19) + "..." + "<b>" +cart[item][0] + "</b>"+ "Qty"  + '<br>';
					i = i + 1;
				}
		  
				popStr = popStr + "</div> <a href='/checkout'><button class='btn btn-success' id='clearCart'>Cart</button></a>  <button class='btn btn-dark' onclick='clearCart()' id='clearCart'>ClearCart</button>"
				document.getElementById('popcart').setAttribute('data-content', popStr);
				$('#popcart').popover('show');
				document.getElementById("popcart").click();
			}
		  
			function clearCart() {
				cart = JSON.parse(localStorage.getItem('cart'));
				for (var item in cart) {
					document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-danger cart">AddtoCard <i class="fa-solid fa-cart-shopping"></i></button>'
				}
				localStorage.clear();
				cart = {};
				updateCart(cart);
				
			   let clear= document.getElementById("popcart").click();
			   document.getElementById("popcart").click();
			  
			}
		  
			function updateCart(cart) {
				var sum = 0;
				for (var item in cart) {
					sum = sum + cart[item][0];
					document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "'class='btn btn-success minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-success plus'> + </button>";
				}
				localStorage.setItem('cart', JSON.stringify(cart));
				document.getElementById('cart').innerHTML = sum;
				console.log(cart);
				updatePopover(cart);
				document.getElementById("popcart").click();
			}
		  
			//if plus or minus button is clicked change the cart as well as the display value
			$('.divpr').on("click", "button.minus", function() {
		  
				a = this.id.slice(7, );
				cart['pr' + a][0] = cart['pr' + a][0] - 1;
				cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
				document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
				updateCart(cart);
				
		  
			})
		  
		  
			$('.divpr').on("click", "button.plus", function() {
		  
				a = this.id.slice(6, );
				cart['pr' + a][0] = cart['pr' + a][0] + 1;
		  
				document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
				updateCart(cart);
				
		  
			})
		  </script>

		  <!-- Include Slick CSS -->
<link rel="stylesheet" type="text/css" href="static/css/slick.css"/>
<link rel="stylesheet" type="text/css" href="static/css/slick-theme.css"/>

<!-- Include Slick JS -->
<script src="static/js/slick.min.js"></script>

<script>
    $('.slick1').slick({
        autoplay: true,
        autoplaySpeed: 3000,
        dots: true,
        arrows: false,
    });
</script>


{% endblock body %}